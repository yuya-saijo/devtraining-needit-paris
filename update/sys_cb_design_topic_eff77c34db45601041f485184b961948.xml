<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_cb_design_topic">
    <sys_cb_design_topic action="INSERT_OR_UPDATE">
        <compiled_topic display_value="Search KB">aff77c34db45601041f485184b961944</compiled_topic>
        <design_definition>{"type":"FlowTopic","triggers":[{"type":"Trigger","name":"5c07853d16784f86b58731f2db783021","triggerType":"request","applicability":{"type":"Applicability","mode":"script","value":"true"},"id":"5c07853d16784f86b58731f2db783021"}],"goals":[{"name":"primary","trigger_id":"5c07853d16784f86b58731f2db783021","nodes":[{"type":"StartGoal","goal_id":"primary","greeting_msg":{"type":"String","mode":"script","value":"(function execute() {\n    /* Script the string logic here.\n       Be sure to return a quoted string.\n\n       For example:\n\n       var result;\n       var x = 1;\n       if (x == 1) {\n           result = 'hi there';\n       } else {\n           result = 'how are you?';\n       }\n       return result;\n    */\n    return '';\n})()\n"},"id":"6fc902e04d55474ea274b31a9c16b146","name":"Start","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"TerminateGoal","goal_id":"primary","confirmation_msg":{"type":"String","mode":"string","value":""},"id":"9ace0b54bf87402ba622a70313f853ea","name":"End","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"InputPrompt","variable_id":"ed4d5fd51c6848599cc43cc2e7325835","message":{"type":"String","mode":"string","value":"gs.getMessageLang(\"Enter a phrase to search the knowledge base.\", vaContext.getRequesterLang())"},"nlu_entity_binding":{"type":"NLUEntityBinding","allow_text_input":true,"use_confirmation_prompt":false},"skippable":{"type":"Applicability","mode":"script","value":"false"},"id":"6bb95ca38fac48d68ff1c31573dbba3e","name":"Search Term","goal_id":"primary","applicability":{"type":"Applicability","mode":"script","value":"true"},"formatType":"Text","validationScript":""},{"type":"ScriptedAction","script":"(function execute() {\n    /* Uses the search term inputed by user and calls the Contextual Search using the search context created\n       to return a max of 20 results and stores them JSON string.\n    */\n    var search_term = vaInputs.search_term;\n    var context = vaVars.search_context_sys_id;\n    var contextualSearch = new global.VAGlobalContextualSearchUtil();\n    var response = contextualSearch.search(context, search_term);\n    var success = contextualSearch.processSearchResponse(response);\n    if (!success) {\n        return;\n    }   \n    var relevantSearchResults = contextualSearch.processGeneralResults(response, 20, -2);\n    vaVars.kbResultCount = relevantSearchResults.length;\n    vaVars.search_kb_json_string = JSON.stringify(relevantSearchResults);\n    vaVars.index = 0;\n    return;\n})()\n","id":"df4b84383ba94fcf996f9d4273f0aaab","name":"Contextual Search","goal_id":"primary","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"ReferenceChoiceInputPrompt","mode":"external","id":"9b838d9e1e1642a0b17d41156f1efc5a","name":"KB Selection","goal_id":"primary","applicability":{"type":"Applicability","mode":"script","value":"true"},"variable_id":"8be26b78304f49a0bf86ee9832ead9d7","message":{"type":"String","mode":"script","value":"(function execute() {\n    if (vaVars.kbResultCount &gt; 0)\n        return gs.getMessage('Alright, how else can I help? Here\\'s what I can do:');\n\n    return gs.getMessage(\"Sorry, I couldn't find anything on that topic. What would you like to do?\");\n})()\n"},"skippable":{"type":"Applicability","mode":"script","value":"false"},"nlu_entity_binding":{"type":"NLUEntityBinding","allow_text_input":false,"use_confirmation_prompt":true},"expression_mode":"script","script":"(function execute() {\n    /*\n    Pagination buttons for suggested KB articles.\n    */\n    var options = [];\n    var limit = parseInt(vaVars.limit);\n    var index = parseInt(vaVars.index);\n    \n    if (index &gt;= limit) {\n        options.push({ 'value': 'show_prev', 'label': gs.getMessage('Show previous')});    \n    }\n\n    if (index+limit &lt; vaVars.kbResultCount) {\n        options.push({ 'value': 'show_next', 'label': gs.getMessage('Show more')});    \n    }\n    options.push({ 'value': 'new_search', 'label': gs.getMessage('Try a different search')});\n    options.push({ 'value': 'cancel', 'label': gs.getMessage('I\\'m done')});\n    return options;\n})()\n","no_options_found_message":{"type":"String","mode":"string","value":"No Records Found"},"condition":{"type":"Condition","mode":"external_script","value":"(function execute() {\n    /*\n    Pagination buttons for suggested KB articles.\n    */\n    var options = [];\n    var limit = parseInt(vaVars.limit);\n    var index = parseInt(vaVars.index);\n    \n    if (index &gt;= limit) {\n        options.push({ 'value': 'show_prev', 'label': gs.getMessage('Show previous')});    \n    }\n\n    if (index+limit &lt; vaVars.kbResultCount) {\n        options.push({ 'value': 'show_next', 'label': gs.getMessage('Show more')});    \n    }\n    options.push({ 'value': 'new_search', 'label': gs.getMessage('Try a different search')});\n    options.push({ 'value': 'cancel', 'label': gs.getMessage('I\\'m done')});\n    return options;\n})()\n"}},{"type":"Decision","name":"Knowledge Choice Decision","branches":[{"type":"Branch","label":"Cancel","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.kb_selection == 'cancel';\n})()\n"},"id":"f4940cc70c7540189da7578606dfe236","name":"Cancel"},{"type":"Branch","label":"New Search","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.kb_selection == 'new_search';\n})()\n"},"id":"4dfda20f9cf7477bb77ec3cfd8f149e4","name":"New Search"},{"type":"Branch","label":"Show Next","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.kb_selection == 'show_next';\n})()\n"},"id":"f879402042a44b8086c00f11e3bfba16","name":"Show Next"},{"type":"Branch","label":"Show Previous","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.kb_selection == 'show_prev';\n})()\n"},"id":"74aa9b2954a94b99905dd106a49d8b35","name":"Show Previous"}],"id":"e9b0c3ad0f9343d1a210d8ed5623eff6","goal_id":"primary","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"ScriptedAction","script":"(function execute() {\n    vaVars.index = parseInt(vaVars.index) + parseInt(vaVars.limit);\n    return '';\n})()\n","id":"30d24b21f8564894a04587e563c34ec3","name":"Next","goal_id":"primary","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"ScriptedAction","script":"(function execute() {\n    vaVars.index = parseInt(vaVars.index) - parseInt(vaVars.limit);\n    return '';\n})()\n","id":"ac0efe5c3f40499d939f239951a3d348","name":"Previous","goal_id":"primary","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"No KBs","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return !(vaVars.kbResultCount &gt; 0);\n})()\n"},"id":"da87e094e2b34029bf36f0763e08af03","name":"No KBs"},{"type":"Branch","label":"Found KB(s)","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.kbResultCount &gt; 0;\n})()\n"},"id":"d5265fae11e842b598da939f8e13f6b8","name":"Found KB(s)"}],"id":"8ace44a764524f039df685dc8b416155","goal_id":"primary","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"gs.getMessageLang(\"Here are the results I found in our Knowledge Base that might help you.\", vaContext.getRequesterLang())"},"id":"460063d85ac948a597985637e83a72ba","name":"Found Result Message","goal_id":"primary","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"LinkOutputPrompt","header":{"type":"String","mode":"script","value":"(function execute() {\n    return '';\n})()\n"},"label":{"type":"String","mode":"string","value":""},"url":{"type":"String","mode":"string","value":""},"link_type":"multiple","multi_link_script":"(function execute(header) {\n\tvar groupedLinksOutMsg = new sn_cs.GroupedPartsOutMsg();\n\tgroupedLinksOutMsg.setHeader(header);\n\tvar limit = parseInt(vaVars.limit);\n\tvar searchJsonObj = JSON.parse(vaVars.search_kb_json_string);\n\tvar index = parseInt(vaVars.index);\n\n\tvar linkBuilder = new global.cxs_SearchResultLinkBuilder();\n\tfor (var i = index; i &lt; index + limit &amp;&amp; i &lt; searchJsonObj.length; i++) {\n\t\tvar link = linkBuilder.build(searchJsonObj[i], vaInputs.portal);\n\t\tgroupedLinksOutMsg.addLinkPart(link.label, link.link, link.description, link.context_label);\n\t}\n\treturn groupedLinksOutMsg;\n})(header)\n","id":"84a38ff29a074e9b85a3a82a18bc8dce","name":"Display KB(s)","goal_id":"primary","applicability":{"type":"Applicability","mode":"script","value":"true"}}],"edges":[{"type":"Edge","source_node_id":"460063d85ac948a597985637e83a72ba","target_node_id":"84a38ff29a074e9b85a3a82a18bc8dce","id":"42ad8760aec041c08a444d55a9753fc8"},{"type":"Edge","source_node_id":"6fc902e04d55474ea274b31a9c16b146","target_node_id":"6bb95ca38fac48d68ff1c31573dbba3e","id":"ceef2e699ab444e9b44a02ece3750e89"},{"type":"Edge","source_node_id":"6bb95ca38fac48d68ff1c31573dbba3e","target_node_id":"df4b84383ba94fcf996f9d4273f0aaab","id":"bd2829bdccb14bf4abfab4ce306f3f68"},{"type":"Edge","source_node_id":"9b838d9e1e1642a0b17d41156f1efc5a","target_node_id":"e9b0c3ad0f9343d1a210d8ed5623eff6","id":"14615fbab6574bab8dc48ef135b9012d"},{"type":"Edge","source_node_id":"e9b0c3ad0f9343d1a210d8ed5623eff6","target_node_id":"9ace0b54bf87402ba622a70313f853ea","branch_id":"f4940cc70c7540189da7578606dfe236","id":"c8b36b3d62324e4aa3503c5164987c7d","name":"f4940cc70c7540189da7578606dfe236"},{"type":"Edge","source_node_id":"e9b0c3ad0f9343d1a210d8ed5623eff6","target_node_id":"6bb95ca38fac48d68ff1c31573dbba3e","branch_id":"4dfda20f9cf7477bb77ec3cfd8f149e4","id":"9f9054680eb24bf7851bd340c167e657","name":"4dfda20f9cf7477bb77ec3cfd8f149e4"},{"type":"Edge","source_node_id":"e9b0c3ad0f9343d1a210d8ed5623eff6","target_node_id":"30d24b21f8564894a04587e563c34ec3","branch_id":"f879402042a44b8086c00f11e3bfba16","id":"ee09a937d99b490e83f533ed3ba56db8","name":"f879402042a44b8086c00f11e3bfba16"},{"type":"Edge","source_node_id":"30d24b21f8564894a04587e563c34ec3","target_node_id":"84a38ff29a074e9b85a3a82a18bc8dce","id":"ffd8c6914c4344e7b544caa3739b772a"},{"type":"Edge","source_node_id":"e9b0c3ad0f9343d1a210d8ed5623eff6","target_node_id":"ac0efe5c3f40499d939f239951a3d348","branch_id":"74aa9b2954a94b99905dd106a49d8b35","id":"523933265fcc4fb298e10347ef969d93","name":"74aa9b2954a94b99905dd106a49d8b35"},{"type":"Edge","source_node_id":"ac0efe5c3f40499d939f239951a3d348","target_node_id":"84a38ff29a074e9b85a3a82a18bc8dce","id":"b937672cbd0f440186a45183dcceac94"},{"type":"Edge","source_node_id":"df4b84383ba94fcf996f9d4273f0aaab","target_node_id":"8ace44a764524f039df685dc8b416155","id":"25fad0daf32d481183bc4df8875fb949"},{"type":"Edge","source_node_id":"8ace44a764524f039df685dc8b416155","target_node_id":"9b838d9e1e1642a0b17d41156f1efc5a","branch_id":"da87e094e2b34029bf36f0763e08af03","id":"9caed0118a344d78bb03bb94eca79e44","name":"da87e094e2b34029bf36f0763e08af03"},{"type":"Edge","source_node_id":"8ace44a764524f039df685dc8b416155","target_node_id":"460063d85ac948a597985637e83a72ba","branch_id":"d5265fae11e842b598da939f8e13f6b8","id":"278af75bcb7e482b91f4e2f47d519f98","name":"d5265fae11e842b598da939f8e13f6b8"},{"type":"Edge","source_node_id":"84a38ff29a074e9b85a3a82a18bc8dce","target_node_id":"9b838d9e1e1642a0b17d41156f1efc5a","id":"64dc66428c3f455eba034951bc383da6"}],"id":"primary"}],"script_variables":[{"type":"String","name":"search_kb_json_string","id":"d907e56234664fe78f64bd61d89b75d0","formatType":"text"},{"type":"String","name":"index","value":{"type":"String","mode":"script"},"id":"ae2f0b4ea6c84da89159c01ea9574c9d","formatType":"text"},{"type":"String","name":"limit","value":{"type":"String","mode":"string","value":"3"},"id":"61fbe471d8c449b4aeb50787a7f00e72","formatType":"text"},{"type":"String","name":"search_context_sys_id","value":{"type":"String","mode":"string","value":"865723c353930010c839ddeeff7b124e"},"id":"835b0eca2cf341f398c3490a54398a96","formatType":"text"},{"type":"String","name":"kbResultCount","value":{"type":"String","mode":"string","value":"0"},"id":"c95e4e9ef854452283ad6d2a5954a79c","formatType":"text"},{"type":"String","name":"LiveAgent_application","value":{"type":"String","mode":"string","value":"itsm"},"id":"e110d446ad5442538914583932fd1365","formatType":"text"}],"glide_variables":[{"type":"String","name":"search_term","id":"ed4d5fd51c6848599cc43cc2e7325835","formatType":"Text","validationScript":""},{"type":"Choice","choices":[],"id":"8be26b78304f49a0bf86ee9832ead9d7","name":"kb_selection","formatType":"text","table":""},{"type":"Reference","table":"sys_user","id":"379926a64c6c4665bd9493507b77e1be","name":"user","formatType":"text"}],"applicability":{"type":"Applicability","mode":"script","value":"true"},"roles":[],"scope":"f8186ec653930010c839ddeeff7b127b","domain":"global","topic_type":"STANDARD","channels":[],"id":"6f4392ee53130010c839ddeeff7b12df","name":"Search KB","key_phrases":["knowledge"," question"," kb"," article"," search"," how"],"nlu_provider":"","nlu_model":"","nlu_model_label":"","nlu_intent":"","nlu_intent_label":"","flexible_conversation_switching":false,"design_category":"3efd22da0b214300a1b16d2367673b32","library":false,"nluMapping":"[]"}</design_definition>
        <design_topic_id>6f4392ee53130010c839ddeeff7b12df</design_topic_id>
        <name>Search KB</name>
        <sys_class_name>sys_cb_design_topic</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2020-12-10 08:23:39</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_id>eff77c34db45601041f485184b961948</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>FlowTopic</sys_name>
        <sys_package display_value="NeedIt" source="x_58872_needit">6ead8e780f603200cd674f8ce1050ed1</sys_package>
        <sys_policy/>
        <sys_scope display_value="NeedIt">6ead8e780f603200cd674f8ce1050ed1</sys_scope>
        <sys_update_name>sys_cb_design_topic_eff77c34db45601041f485184b961948</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2020-12-10 08:23:39</sys_updated_on>
        <type>FlowTopic</type>
    </sys_cb_design_topic>
</record_update>
